---
id: 面试题三

slug: 面试题三.html

title: 03 | 面试题三

author: 鲤鱼

tag:

  - 面试题
---

### class_getInstanceSize、malloc_size、sizeof 的区别

- `sizeof` ：不是一个函数，是运算符，在编译期检查类型指针所占的大小，这里计算的是其类型的长度

- `class_getInstanceSize`：在运行时返回对象实际占用的内存大小，按照 8 字节对齐

- `malloc_size`：会返回系统为对象分配的内存大小，在 iOS 和 macOS 系统中，系统最小为对象分配 16 字节的内存

  

### @synthesize 合成实例变量的规则是什么？例如@property 存在一个名为 foo 的属性，在声明一个@property 名为_foo，会导致什么后果？

- 如果显示写明了`@synthesize` 规则，且`@sythesize foot = **`，其中`**` 不是 `_foo`  那么可以同时存在。
- 如果未显示写明了`@synthesize` 规则，属性则自动与`_+属性_` 关联成员变量，此时 `xcode` 会报出 `warnning`，且不会自动合成心变量。

### unrecognized selector 异常出现在什么情况下？

调用该对象某个方法但是缺少方法实现的时候会出现该异常。
消息转发可以查看个人博客[《objc_msgSend消息传递学习笔记 - 消息转发》](https://www.desgard.com/objc_msgSend2/)。

**1. 动态方法解析过程**

当 `objc_msgSend` 无法在 *Fast Map* 中根据选择子查询到对应名称的方法时，进入 `resolveInstanceMethon` 过程。在 `resolveInstanceMethod` 过程中，进入入口方法 `_class_resolveMethod`，先根据 isa 的指向来判断是类方法还是成员方法，从而调用 `resolveInstanceMethod` 或者 `resolveClassMethod`。主体流程中，执行 `lookUpImpOrNil` 方法在方法列表中来搜索 `IMP` 指针。若仍未命中，继续进入 **备援接受阶段**。

**2. Forwarding 备援接收**

如果选择子未命中，则继续将其传递给其他接受者来处理。这一块代码调用的主要方法为 `forwardingTargetForSelector: (SEL)selector`。在 Core Foundation 中这一方法的实现被隐藏，暴露出来的 `__forwarding__` 的核心方法 `objc_msgSend_stret` 也被隐藏。

**3. Message Dispatch System 消息派发**

在 Forwarding 步骤中最后会创建一个 `NSInvocation` 对象，其中包括了对应的选择子、target 主要参数。倘若自下而上始终没有发现可处理改消息的方式，则调用 `doesNotRecognizeSelector` 从而抛出异常。

![mianshi_05](../assets/面试题/mianshi_05.png)

### oc 对象的 isa 指针指向什么? 有什么作用？

**isa 指针指向**

- 普通实例对象的 isa 指向类对象

- 类对象的 isa 指向 meta-class

- meta-class 的 isa 指向基类(可以理解为 NSObject)的 meta-class

  

**superclass 指针指向**

- 类对象的 superclass 指向父类类对象，如果父类不存在，superclass 指向 nil

- meta-class 的 superclass 指向父类的 meta-class，基类的 meta-class 的 superclass 指向基类的类对象。

  

佛挡杀佛

- 普通实例对象的 isa 指向类对象

- 类对象的 isa 指向 meta-class

- meta-class 的 isa 指向基类(可以理解为 NSObject)的 meta-class

  

  

  

  
